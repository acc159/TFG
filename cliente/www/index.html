<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Home</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>


<body>
    <h1>En pruebas</h1>

    <!-- Estructura REAL -->
    <h1>Bienvenido: {{.User.Email}}</h1>
    <h1>Listado de proyectos</h1>

    <div id="proyectos">
        {{if not .Datos}}
        <h1>No tienes ningun proyecto</h1>
        {{else}}
            {{range .Datos}}
            <div id="{{.Proyecto.ID}}">
                <h1>{{.Proyecto.Cipherdata}}</h1>
                <button>Actualizar Proyecto</button>
                <button class="deleteProyect">Eliminar Proyecto</button>
                {{if not .Listas}}
                <h2>Ninguna Lista que mostrar</h2>
                {{else}}
                    {{range .Listas}}
                    <h2> {{.Cipherdata}}</h2>
                    {{end}}
                {{end}}
            </div>
            {{end}}
        {{end}}
 
    </div>

    
    

    <div class="proyectos" id="proyectos">
    </div>

    <h2>Añadir Proyecto nuevo</h2>
    <div>
        <label for="proyectName">Nombre del proyecto</label>
        <input type="text" id="proyectName" name="proyectName"><br><br>
        <button>Añadir Proyecto</button>
    </div>


<!-- 
    <button onclick="llamoDesdeJavaScriptaFuncionGO()">Pulsame para ejecutar la funcion en GOLANG</button>
    <button onclick="llamarAprueba()">Traer Proyectos Usuario</button> -->
    
</body>




<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

<script>

    //Crea un div por cada proyecto que este relacionado con el usuario
    function createDivsProyects(relations){
        let proyectsIDS = [];
        //Primero creo un array con todos los ids de los proyectos , en este habran repetidos
        for (let i in relations){
            proyectsIDS.push(relations[i].ProyectID)
        }

        //Aqui limpio del array los ids repetidos
        let idsSinRepetir = proyectsIDS.filter((item, index) => {
            return proyectsIDS.indexOf(item) === index;   
        })

        //Creo un div dentro del div general de proyectos por cada proyectID
        for (let index = 0; index < idsSinRepetir.length; index++){
            var proyectos = document.querySelector('#proyectos');
            var div = document.createElement("div");
            div.id = idsSinRepetir[index];

            var titulo_lista = document.createElement('h2')
            titulo_lista.textContent = "Listas del proyecto"
            div.appendChild(titulo_lista)

            proyectos.appendChild(div)
        }
    }

    //Llamo a GO para obtener las relaciones del usuario
    function callRecibirProyectosyListasenGO(){
        recibirProyectosyListasenGO().then(
            function(relations){  

                if (relations == null) {
                        alert('No hay proyectos para el usuario')
                }else{
                    createDivsProyects(relations)
                    //Recorro cada relacion y agrego en el div correspondiente datos
                    for (let indice = 0; indice < relations.length; indice++){
                        //Obtengo el proyecto sobre el que meter la Lista
                        div = document.getElementById(relations[indice].ProyectID)
                        var tag = document.createElement("p");
                        tag.textContent = relations[indice].ListKey;
                        div.appendChild(tag);
                    }
                }
            }
        )
    }

    function init(){
        //alert("Bienvenido");
        //let boton = document.querySelector('.deleteProyect').textContent;
        //alert(boton);
    }

    document.addEventListener('DOMContentLoaded',init,false);
</script>